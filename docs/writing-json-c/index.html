<!DOCTYPE html>
<html>
    <head>
    <title>Writing json in C&#43;&#43; &#9889; /dev/log</title>

        <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <meta name="msvalidate.01" content="AF2CB1331E78B3C8BAE565C82C1AE415" />

        <meta property="og:title" content="Writing json in C&#43;&#43;" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:url" content="https://marc.helbling.fr/writing-json-c/" />
    


    <link rel="shortcut icon" href="/favicon.png">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Halant:300" rel="stylesheet">

    <link href="" rel="alternate" type="application/rss+xml" title="/dev/log" />
    <link href="" rel="feed" type="application/rss+xml" title="/dev/log" />

    <link rel="stylesheet" href="https://marc.helbling.fr//css/malt.css">
    

    <link href="http://gmpg.org/xfn/11" rel="profile">

    

    <meta name="generator" content="Hugo 0.148.2">
</head>


    <body>
        <div id="container">
            <header id="header">
    <div id="header-outer" class="outer">
        <div id="header-inner" class="inner">
            <a class="main-nav-link" style="font-size: 24px" href="https://marc.helbling.fr/">/dev/log</a>
            <a class="main-nav-link" style="font-size: 18px" href="/about">about</a>
            <a class="main-nav-link" style="font-size: 18px" href="/index.xml">rss</a>
        </div>
    </div>
</header>


            <section id="main" class="outer">
                <article class="article article-type-post" itemscope itemprop="post">
    <div class="article-inner">
        
            <header class="article-header">
                <h1 class="article-title" itemprop="name">Writing json in C&#43;&#43;</h1>
            </header>
        

        <div class="article-entry" itemprop="articleBody">
            <p>Writing a valid json file looks simple. Except that if the json file contains real world data coming from unknown sources, it might not be that simple. The <a href="http://json.org">json</a> format does not support everything that you could expect for numerical values and strings.</p>
<p>More specifically, a numerical value involves digits in json. This prevents from having <code>inf</code> or <code>nan</code> serialized in json.
Strings preferred encoding is UTF-8 with some restriction. Quotes <code>&quot;</code> and backslash <code>\</code> have to be escaped but <a href="http://en.wikipedia.org/wiki/Unicode_control_characters">control characters</a> should be encoded with their unicode 4 hex digits representation.</p>
<p>As the C++ standard library does not implement JSON, it makes it a good exercise putting into practice a bit of template functions and STL usage.</p>
<p>Note: for a benchmark of existing C++ libraries dealing with json, see the <a href="https://github.com/miloyip/nativejson-benchmark">nativejson benchmark</a>.</p>
<h2 id="json-stream">
  json stream
  <a class="heading-anchor" href="#json-stream" aria-label="Link to this section">
    #
  </a>
</h2>
<p>What we need to achieve is simply to sanitize data when streaming it into an output stream. So we basically want to override the behavior of <code>&lt;&lt;</code>. We could try to inherit <code>std::ofstream</code> and simply reimplement the desired operator. However, deriving from <code>basic_ostream</code> is really <a href="http://www.math.hkbu.edu.hk/parallel/pgi/doc/pgC++_lib/stdlibug/cre_2288.htm">cumbersome</a>. It is much easier and safer to simply implement a wrapper around some <code>std::ofstream</code> object:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;fstream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">json_stream</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    json_stream(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string<span style="color:#f92672">&amp;</span> path) <span style="color:#f92672">:</span> _stream(path.c_str())
</span></span><span style="display:flex;"><span>    {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    json_stream<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(<span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> data) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (_stream.is_open()) {
</span></span><span style="display:flex;"><span>            _stream <span style="color:#f92672">&lt;&lt;</span> dump(data);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>ofstream _stream;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h1 id="object-serialization">
  Object serialization
  <a class="heading-anchor" href="#object-serialization" aria-label="Link to this section">
    #
  </a>
</h1>
<p>JSON defines very few structures:</p>
<ul>
<li>numbers</li>
<li>strings</li>
<li>ordered list of values i.e. array</li>
<li>collection of name/value pair i.e. associative array where name should be a string</li>
</ul>
<p>Using template construct, we can easily set up functions that will recursively JSON serialize complex structures</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sstream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;map&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">is_container</span> <span style="color:#f92672">:</span> std<span style="color:#f92672">::</span>false_type {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">is_associative_container</span> <span style="color:#f92672">:</span> std<span style="color:#f92672">::</span>false_type {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// vector overload
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">is_container</span><span style="color:#f92672">&lt;</span> std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">:</span> std<span style="color:#f92672">::</span>true_type {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// map overload
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> K, <span style="color:#66d9ef">typename</span> V<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">is_container</span><span style="color:#f92672">&lt;</span> std<span style="color:#f92672">::</span>map<span style="color:#f92672">&lt;</span>K, V<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">:</span> std<span style="color:#f92672">::</span>true_type {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> K, <span style="color:#66d9ef">typename</span> V<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">is_associative_container</span><span style="color:#f92672">&lt;</span> std<span style="color:#f92672">::</span>map<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string, V<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">:</span> std<span style="color:#f92672">::</span>true_type {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">json_stream</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump(<span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> t) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// dispatch to actual dump method:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// * not iterable type dumped as simple value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// * iterable type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//   * with mapped value dumped as mapped_container
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//   * otherwise dumped as simple_container
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">dump_value_or_container</span>(t, <span style="color:#66d9ef">typename</span> is_container<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;::</span>type());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// dispatch to correct dump method
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_value_or_container(<span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> t, std<span style="color:#f92672">::</span>false_type) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">dump_value</span>(t);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_value_or_container(<span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> t, std<span style="color:#f92672">::</span>true_type) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">dump_simple_or_associative_container</span>(t, <span style="color:#66d9ef">typename</span> is_associative_container<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;::</span>type());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_simple_or_associative_container(<span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> t, std<span style="color:#f92672">::</span>false_type) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">dump_simple_container</span>(t);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_simple_or_associative_container(<span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> t, std<span style="color:#f92672">::</span>true_type) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">dump_associative_container</span>(t);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// implement type specific serialization
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> V<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_value(<span style="color:#66d9ef">const</span> V<span style="color:#f92672">&amp;</span> value) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>ostringstream oss;
</span></span><span style="display:flex;"><span>        oss <span style="color:#f92672">&lt;&lt;</span> sanitize(value);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> oss.str();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_value(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string<span style="color:#f92672">&amp;</span> value) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> value <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> K, <span style="color:#66d9ef">typename</span> V<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_value(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">const</span> K, V<span style="color:#f92672">&gt;&amp;</span> pair) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>ostringstream oss;
</span></span><span style="display:flex;"><span>        oss <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">&lt;&lt;</span> dump(pair.first) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#f92672">&lt;&lt;</span> dump(pair.second) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;]&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> oss.str();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> V<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_pair(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string, V<span style="color:#f92672">&gt;&amp;</span> pair) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>ostringstream oss;
</span></span><span style="display:flex;"><span>        oss <span style="color:#f92672">&lt;&lt;</span> dump(pair.first) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> dump(pair.second);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> oss.str();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> C<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_simple_container(<span style="color:#66d9ef">const</span> C<span style="color:#f92672">&amp;</span> container) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>ostringstream oss;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">typename</span> C<span style="color:#f92672">::</span>const_iterator it <span style="color:#f92672">=</span> container.begin();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        oss <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">&lt;&lt;</span> dump(<span style="color:#f92672">*</span>it);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#f92672">++</span> it ; it <span style="color:#f92672">!=</span> container.end() ; <span style="color:#f92672">++</span> it) {
</span></span><span style="display:flex;"><span>            oss <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#f92672">&lt;&lt;</span> dump(<span style="color:#f92672">*</span>it);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        oss <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;]&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> oss.str();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> M<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string dump_associative_container(<span style="color:#66d9ef">const</span> M<span style="color:#f92672">&amp;</span> map) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>ostringstream oss;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">typename</span> M<span style="color:#f92672">::</span>const_iterator it <span style="color:#f92672">=</span> map.begin();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        oss <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;{&#34;</span> <span style="color:#f92672">&lt;&lt;</span> dump_pair(<span style="color:#f92672">*</span>it);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#f92672">++</span> it ; it <span style="color:#f92672">!=</span> map.end() ; <span style="color:#f92672">++</span> it) {
</span></span><span style="display:flex;"><span>            oss <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#f92672">&lt;&lt;</span> dump_pair(<span style="color:#f92672">*</span>it);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        oss <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;}&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> oss.str();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    T sanitize(<span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> t) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> t;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span></code></pre></div><p>Note that, for generic <code>map&lt;K, V&gt;</code> where <code>K</code> is not <code>std::string</code>, we did not serialize the key as a string but instead serialized generic <code>pair&lt;K, V&gt;</code> as a container.</p>
<p>We now have all the machinery in place:</p>
<ul>
<li>depending on the container nature, we serialize it as a JSON array or a JSON associative array.</li>
<li>when serializing a &lsquo;final&rsquo; value, we call a <code>sanitize</code> method (that will return the input object by default).</li>
</ul>
<p>So to customize our serializer we just have to:</p>
<ul>
<li>specialize the <code>is_container</code> and <code>is_associative_container</code> traits to support new containers; this approach is much easier to understand and read than typical SFINAE and notice that every code path is defined at compile time;</li>
<li><em>overload</em>  <code>sanitize</code> method for specific input types. C++ will indeed prefer a non templated function over a templated function. This has the advantage that it enables to change the function signature to meet some specific needs.</li>
</ul>
<h2 id="infinity-and-not-a-number">
  infinity and not-a-number
  <a class="heading-anchor" href="#infinity-and-not-a-number" aria-label="Link to this section">
    #
  </a>
</h2>
<p>From the <a href="http://www.ietf.org/rfc/rfc4627.txt">RFC 4627</a>,</p>
<blockquote>
<p>Numeric values that cannot be represented as sequences of digits
(such as Infinity and NaN) are not permitted.</p></blockquote>
<p>This is probably arguable as the <a href="http://en.wikipedia.org/wiki/IEEE_floating_point">IEEE 754</a> standard defines <code>inf</code> and <code>nan</code>. Let’s see how some languages deal with this in their json libraries:</p>
<ul>
<li>Python:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> json<span style="color:#f92672">.</span>dumps(float(<span style="color:#e6db74">&#39;nan&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;NaN&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> json<span style="color:#f92672">.</span>loads(json<span style="color:#f92672">.</span>dumps(float(<span style="color:#e6db74">&#39;nan&#39;</span>)))
</span></span><span style="display:flex;"><span>nan
</span></span></code></pre></div><p>Python does not conform to the RFC but is consistent.</p>
<ul>
<li>Ruby</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>irb(main):<span style="color:#ae81ff">001</span>:<span style="color:#ae81ff">0</span><span style="color:#f92672">&gt;</span> require <span style="color:#e6db74">&#39;json&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>irb(main):<span style="color:#ae81ff">002</span>:<span style="color:#ae81ff">0</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">JSON</span><span style="color:#f92672">.</span>dump(Float<span style="color:#f92672">::</span><span style="color:#66d9ef">NAN</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;NaN&#34;</span>
</span></span><span style="display:flex;"><span>irb(main):<span style="color:#ae81ff">003</span>:<span style="color:#ae81ff">0</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">JSON</span><span style="color:#f92672">.</span>parse(<span style="color:#e6db74">&#39;{&#34;key&#34;: NaN}&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JSON</span><span style="color:#f92672">::</span><span style="color:#e6db74">ParserError</span>: <span style="color:#ae81ff">209</span>: unexpected token at <span style="color:#e6db74">&#39;NaN}&#39;</span>
</span></span><span style="display:flex;"><span>	from <span style="color:#e6db74">/Library/</span><span style="color:#66d9ef">Ruby</span><span style="color:#f92672">/</span><span style="color:#66d9ef">Gems</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span>gems<span style="color:#f92672">/</span>json<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">.</span><span style="color:#ae81ff">8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>json<span style="color:#f92672">/</span>common<span style="color:#f92672">.</span>rb:<span style="color:#ae81ff">155</span><span style="color:#e6db74">:in</span> <span style="color:#e6db74">`parse&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	from /Library/Ruby/Gems/2.0.0/gems/json-1.8.1/lib/json/common.rb:155:in `</span>parse<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	from (irb):3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	from /usr/bin/irb:12:in `&lt;main&gt;&#39;</span>
</span></span><span style="display:flex;"><span>irb(main):<span style="color:#ae81ff">004</span>:<span style="color:#ae81ff">0</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">JSON</span><span style="color:#f92672">.</span>parse(<span style="color:#e6db74">&#39;{&#34;key&#34;: NaN}&#39;</span>, <span style="color:#e6db74">allow_nan</span>: <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">=&gt;</span> {<span style="color:#e6db74">&#34;key&#34;</span><span style="color:#f92672">=&gt;</span><span style="color:#66d9ef">NaN</span>}
</span></span></code></pre></div><p>Ruby (2.0.0p481) is not so consistent. It will serialize a <code>nan</code> but, by default, will not deserialize it.</p>
<ul>
<li>(Node)JS</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#66d9ef">NaN</span>)
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;null&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#39;NaN&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SyntaxError</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Unexpected</span> <span style="color:#a6e22e">token</span> <span style="color:#a6e22e">N</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> Object.<span style="color:#a6e22e">parse</span> (<span style="color:#66d9ef">native</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">repl</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">REPLServer</span>.<span style="color:#a6e22e">self</span>.eval (<span style="color:#a6e22e">repl</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">110</span><span style="color:#f92672">:</span><span style="color:#ae81ff">21</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">Interface</span>.<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">anonymous</span><span style="color:#f92672">&gt;</span> (<span style="color:#a6e22e">repl</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">239</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">Interface</span>.<span style="color:#a6e22e">emit</span> (<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">95</span><span style="color:#f92672">:</span><span style="color:#ae81ff">17</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">Interface</span>.<span style="color:#a6e22e">_onLine</span> (<span style="color:#a6e22e">readline</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">203</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">Interface</span>.<span style="color:#a6e22e">_line</span> (<span style="color:#a6e22e">readline</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">532</span><span style="color:#f92672">:</span><span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">Interface</span>.<span style="color:#a6e22e">_ttyWrite</span> (<span style="color:#a6e22e">readline</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">761</span><span style="color:#f92672">:</span><span style="color:#ae81ff">14</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">ReadStream</span>.<span style="color:#a6e22e">onkeypress</span> (<span style="color:#a6e22e">readline</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">ReadStream</span>.<span style="color:#a6e22e">emit</span> (<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">98</span><span style="color:#f92672">:</span><span style="color:#ae81ff">17</span>)
</span></span></code></pre></div><p>JS is somehow consistent and conforms to the RFC. However, <code>null</code> is untyped so depending on the usage this might lead to some issues. Also, JS serializes <code>inf</code> is serialized to <code>null</code> too making <code>inf</code> and <code>nan</code> indistinguishable from a consumer point of view.</p>
<p>The RFC therefore seems like the way to go if the json has to be consumed by different environments.</p>
<p>We have two straightforward ways to handle non finite floating values:</p>
<ul>
<li>serialize them as string and have a post json deserialization step fixing those values</li>
<li>remapping those values to json serialize finite values.</li>
</ul>
<p>The choice might be application specific. Using string serialization requires an extra step that should be implemented by all consumers. The second option while not entirely satisfactory has the advantage of not adding any requirement on consumers. Let’s use this option and replace <code>inf</code> by the maximum representable value and <code>nan</code> by 0:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> sgn(<span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span>  val) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (T(<span style="color:#ae81ff">0</span>) <span style="color:#f92672">&lt;</span> val) <span style="color:#f92672">-</span> (val <span style="color:#f92672">&lt;</span> T(<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">double</span> <span style="color:#a6e22e">sanitize</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">double</span> d) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(std<span style="color:#f92672">::</span>isfinite(d)) { <span style="color:#75715e">// include &lt;cmath&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> d;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(std<span style="color:#f92672">::</span>isinf(d)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> sgn(d) <span style="color:#f92672">*</span> std<span style="color:#f92672">::</span>numeric_limits<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;::</span>max(); <span style="color:#75715e">// include &lt;limits&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0.</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">double</span> <span style="color:#a6e22e">sanitize</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">float</span> f) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sanitize(<span style="color:#66d9ef">static_cast</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span>(f));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Notice that we here benefit from the possibility of changing the function signature and have <code>double sanitize(const float)</code> instead of <code>float sanitize(const float&amp;)</code>. This would not be possible if we were specializing a templated function.</p>
<h2 id="string">
  String
  <a class="heading-anchor" href="#string" aria-label="Link to this section">
    #
  </a>
</h2>
<p>Manipulating text encodings is a pain in C++ (at least to my knowledge). The standard library mostly offers conversion between locale facets i.e. “class[es] describing a locale feature set associated to a specific cultural aspect.&quot; (see <a href="http://www.cplusplus.com/reference/locale/locale/facet/">locale/facet</a>). The basic <code>std::string</code> type is a simple <code>char</code> i.e. byte container with no constraint and <code>std::wstring</code> is tightly bound to the system locale which is not always very useful.</p>
<p>To conform with the RFC 4627, we need to make sure every string is UTF-8 encoded and <code>\</code>, <code>/</code>, <code>\b</code>, <code>\f</code>, <code>\n</code>, <code>\r</code> and <code>\t</code> must be escaped and other control characters must be “unicode escaped” i.e. represented using <code>\\uxxxx</code>. We will suppose that input data is <em>mostly</em> UTF-8 encoded and will replace bad byte sequence by <code>\ufffd</code>. For the sake of the exercise, we will not use any library for this. <a href="http://utfcpp.sourceforge.net/">utfcpp</a> or <a href="https://github.com/pocoproject/poco">poco</a> would do the job.</p>
<p>One important point when considering text decoding/encoding is wether the sequence should be considered signed or not. In our case, UTF-8 decoding/encoding will only require bit masks and shifts so the sign does not matter.</p>
<p>Let’s first write a naive UTF-8 decoder; we will parse the string and transform byte sequence to code points:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">mask8</span>(<span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> value) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> value <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xff</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">is_valid_continuation_byte</span>(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> byte) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ((byte <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xC0</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x80</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get_next_byte</span>(std<span style="color:#f92672">::</span>string<span style="color:#f92672">::</span>const_iterator<span style="color:#f92672">&amp;</span> iterator, std<span style="color:#f92672">::</span>string<span style="color:#f92672">::</span>const_iterator end_iterator) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(iterator <span style="color:#f92672">!=</span> end_iterator) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> mask8(<span style="color:#f92672">*</span>(<span style="color:#f92672">++</span> iterator));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// invalid continuation byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">insert_replacement</span>(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;&amp;</span> output, <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> replacement, <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> count) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ; i <span style="color:#f92672">&lt;</span> count ; <span style="color:#f92672">++</span> i) {
</span></span><span style="display:flex;"><span>        output.push_back(replacement);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> decode_utf8(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string<span style="color:#f92672">&amp;</span> input, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> replacement<span style="color:#f92672">=</span><span style="color:#ae81ff">0xfffd</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> code_unit1, code_unit2, code_unit3, code_unit4;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> codepoints;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(std<span style="color:#f92672">::</span>string<span style="color:#f92672">::</span>const_iterator iterator <span style="color:#f92672">=</span> input.begin() ; iterator <span style="color:#f92672">!=</span> input.end() ; <span style="color:#f92672">++</span> iterator) {
</span></span><span style="display:flex;"><span>        code_unit1 <span style="color:#f92672">=</span> mask8(<span style="color:#f92672">*</span>iterator);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (code_unit1 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x80</span>) {
</span></span><span style="display:flex;"><span>            codepoints.push_back(code_unit1);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> (code_unit1 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0xC2</span>) { <span style="color:#75715e">// continuation or overlong 2-byte sequence
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            codepoints.push_back(replacement);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> (code_unit1 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0xE0</span>) { <span style="color:#75715e">// 2-byte sequence
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            code_unit2 <span style="color:#f92672">=</span> get_next_byte(iterator, input.end());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>is_valid_continuation_byte(code_unit2)) {
</span></span><span style="display:flex;"><span>                insert_replacement(codepoints, replacement, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                codepoints.push_back((code_unit1 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>) <span style="color:#f92672">+</span> code_unit2 <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x3080</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> (code_unit1 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0xF0</span>) { <span style="color:#75715e">// 3-byte sequence
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            code_unit2 <span style="color:#f92672">=</span> get_next_byte(iterator, input.end());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>is_valid_continuation_byte(code_unit2) <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                (code_unit1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0xE0</span> <span style="color:#f92672">&amp;&amp;</span> code_unit2 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0xA0</span>)) <span style="color:#75715e">/* overlong */</span> {
</span></span><span style="display:flex;"><span>                insert_replacement(codepoints, replacement, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                code_unit3 <span style="color:#f92672">=</span> get_next_byte(iterator, input.end());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>is_valid_continuation_byte(code_unit3)) {
</span></span><span style="display:flex;"><span>                    insert_replacement(codepoints, replacement, <span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    codepoints.push_back((code_unit1 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span> (code_unit2 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>) <span style="color:#f92672">+</span> code_unit3 <span style="color:#f92672">-</span> <span style="color:#ae81ff">0xE2080</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> (code_unit1 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0xF5</span>) { <span style="color:#75715e">// 4-byte sequence
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            code_unit2 <span style="color:#f92672">=</span> get_next_byte(iterator, input.end());
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>is_valid_continuation_byte(code_unit2) <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>               (code_unit1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0xF0</span> <span style="color:#f92672">&amp;&amp;</span> code_unit2 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x90</span>) <span style="color:#f92672">||</span> <span style="color:#75715e">/* overlong */</span>
</span></span><span style="display:flex;"><span>               (code_unit1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0xF4</span> <span style="color:#f92672">&amp;&amp;</span> code_unit2 <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0x90</span>)) {  <span style="color:#75715e">/* &gt; U+10FFFF */</span>
</span></span><span style="display:flex;"><span>                insert_replacement(codepoints, replacement, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                code_unit3 <span style="color:#f92672">=</span> get_next_byte(iterator, input.end());
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>is_valid_continuation_byte(code_unit3)) {
</span></span><span style="display:flex;"><span>                    insert_replacement(codepoints, replacement, <span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    code_unit4 <span style="color:#f92672">=</span> get_next_byte(iterator, input.end());
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>is_valid_continuation_byte(code_unit4)) {
</span></span><span style="display:flex;"><span>                        insert_replacement(codepoints, replacement, <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                        codepoints.push_back((code_unit1 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">18</span>) <span style="color:#f92672">+</span> (code_unit2 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span> (code_unit3 <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>) <span style="color:#f92672">+</span> code_unit4 <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x3C82080</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/* &gt; U+10FFFF */</span>
</span></span><span style="display:flex;"><span>            insert_replacement(codepoints, replacement, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> codepoints;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This piece of code is pretty long but really simple. We try to decode a single codepoint by progressively reading up to 4 bytes and validate that each “prefix” is a valid UTF-8 sequence otherwise we insert an replacement value for each invalid byte.</p>
<p>We can now iterate over the codepoints and encode them using the JSON rules:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string json_encode_control_char(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> codepoint) {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>ostringstream oss;
</span></span><span style="display:flex;"><span>    oss.fill(<span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>    oss <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">u&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>setw(<span style="color:#ae81ff">4</span>) <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>hex <span style="color:#f92672">&lt;&lt;</span> codepoint;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> oss.str();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string utf8_encode(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> codepoint) {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string output;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(codepoint <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x590</span> <span style="color:#f92672">&amp;&amp;</span> codepoint <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x5F4</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> output;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// out of range
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>(codepoint <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1114112</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">utf8_encode</span>(<span style="color:#ae81ff">0xfffd</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (codepoint <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x80</span>) {
</span></span><span style="display:flex;"><span>        output.push_back(codepoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> (codepoint <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0x7FF</span>) {
</span></span><span style="display:flex;"><span>        output.push_back((codepoint <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">6</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0xC0</span>);
</span></span><span style="display:flex;"><span>        output.push_back((codepoint <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x3F</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x80</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> (codepoint <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0xFFFF</span>) {
</span></span><span style="display:flex;"><span>        output.push_back((codepoint <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0xE0</span>);
</span></span><span style="display:flex;"><span>        output.push_back(((codepoint <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">6</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x3F</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x80</span>);
</span></span><span style="display:flex;"><span>        output.push_back((codepoint <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x3F</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x80</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> (codepoint <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0x10FFFF</span>) {
</span></span><span style="display:flex;"><span>        output.push_back((codepoint <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">18</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0xF0</span>);
</span></span><span style="display:flex;"><span>        output.push_back(((codepoint <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x3F</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x80</span>);
</span></span><span style="display:flex;"><span>        output.push_back(((codepoint <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">6</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x3F</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x80</span>);
</span></span><span style="display:flex;"><span>        output.push_back((codepoint <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x3F</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x80</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> output;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string json_encode_codepoints(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">const</span><span style="color:#f92672">&amp;</span> codepoints) {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string json_string;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;::</span>const_iterator codepoint <span style="color:#f92672">=</span> codepoints.begin() ; codepoint <span style="color:#f92672">!=</span> codepoints.end() ; <span style="color:#f92672">++</span> codepoint) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>) { <span style="color:#75715e">// \b
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            json_string.push_back(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>            json_string.push_back(<span style="color:#e6db74">&#39;b&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span>(<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">==</span> <span style="color:#ae81ff">9</span>) {  <span style="color:#75715e">// \t
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            json_string.push_back(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>            json_string.push_back(<span style="color:#e6db74">&#39;t&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span>(<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span>) { <span style="color:#75715e">// \n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            json_string.push_back(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>            json_string.push_back(<span style="color:#e6db74">&#39;n&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span>(<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">==</span> <span style="color:#ae81ff">12</span>) { <span style="color:#75715e">// \f
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            json_string.push_back(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>            json_string.push_back(<span style="color:#e6db74">&#39;f&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span>(<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">==</span> <span style="color:#ae81ff">13</span>) { <span style="color:#75715e">// \r
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            json_string.push_back(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>            json_string.push_back(<span style="color:#e6db74">&#39;r&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span>(<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">==</span> <span style="color:#ae81ff">34</span>) { <span style="color:#75715e">// &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            json_string.push_back(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>            json_string.push_back(<span style="color:#e6db74">&#39;&#34;&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span>(<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">==</span> <span style="color:#ae81ff">47</span>) { <span style="color:#75715e">// /
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            json_string.push_back(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>            json_string.push_back(<span style="color:#e6db74">&#39;/&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span>(<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">==</span> <span style="color:#ae81ff">92</span>) {
</span></span><span style="display:flex;"><span>            json_string.push_back(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>            json_string.push_back(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span>(<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">32</span> <span style="color:#f92672">||</span> <span style="color:#f92672">*</span>codepoint <span style="color:#f92672">==</span> <span style="color:#ae81ff">127</span> <span style="color:#f92672">||</span> (<span style="color:#f92672">*</span>codepoint <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">128</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">*</span>codepoint <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">159</span>)) {
</span></span><span style="display:flex;"><span>            json_string <span style="color:#f92672">+=</span> json_encode_control_char(<span style="color:#f92672">*</span>codepoint);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            json_string <span style="color:#f92672">+=</span> utf8_encode(<span style="color:#f92672">*</span>codepoint);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> json_string;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>By composing those decoding/encoding functions together we finally have our string sanitization function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string sanitize(std<span style="color:#f92672">::</span>string <span style="color:#66d9ef">const</span><span style="color:#f92672">&amp;</span> input) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">json_encode_codepoints</span>(decode_utf8(input));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="conclusion">
  Conclusion
  <a class="heading-anchor" href="#conclusion" aria-label="Link to this section">
    #
  </a>
</h1>
<p>Even though it may be a better choice to use an existing library for production code (see <a href="http://json.org/">language libraries</a>), writing a json serializer is a good exercise as it involves a lot of C++ mechanisms (templates, function overload, recursion etc.) and “standards” (JSON, IEEE 754, Unicode).</p>
<p>The exercice can be refined a lot: beautification, support for heterogeneous types, deserializer etc.
It deals with real world issues (and trade-offs) and is typically the kind of stuff that should probably be taught (more) to students.</p>
<p>Code available as a <a href="https://gist.github.com/marchelbling/658f6c3f7c882974eb96">gist</a>.</p>

        </div>

        
            
            <footer class="article-footer">
                <ul class="article-tag-list">
                    
                        <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="https://marc.helbling.fr//tags/c&#43;&#43;">c&#43;&#43;</a>
                        </li>
                    
                        <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="https://marc.helbling.fr//tags/json">json</a>
                        </li>
                    
                </ul>
            </footer>
        
    </div>
</article>

            </section>

            <footer id="footer">

</footer>

        </div>
    </body>
</html>
